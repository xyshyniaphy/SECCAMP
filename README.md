# SECCAMPï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å ´æ¢ç´¢AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰å®Œå…¨ä»•æ§˜æ›¸

**ç‰ˆ:** 3.0 (Complete)  
**ä½œæˆæ—¥:** 2025å¹´12æœˆ24æ—¥  
**æœ€çµ‚æ›´æ–°:** 2025å¹´12æœˆ24æ—¥ 19:35 JST  
**æ–‡æ›¸ç¨®åˆ¥:** å®Ÿè£…ç”¨è©³ç´°ä»•æ§˜æ›¸  
**å¯¾è±¡:** é–‹ç™ºè€…ãƒ»é‹ç”¨æ‹…å½“è€…

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

æœ¬æ–‡æ›¸ã¯ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å ´ã«é©ã—ãŸåœŸåœ°ã‚’è‡ªå‹•æ¤œç´¢ãƒ»åˆ†æã—ã€æ—¥æ¬¡ãƒ–ãƒ­ã‚°ã¨ã—ã¦å…¬é–‹ã™ã‚‹ãƒãƒƒãƒã‚·ã‚¹ãƒ†ãƒ ã€ŒSECCAMPã€ã®å®Œå…¨ãªæŠ€è¡“ä»•æ§˜æ›¸ã§ã™ã€‚

### ã‚·ã‚¹ãƒ†ãƒ ç‰¹æ€§

- **å®Ÿè¡Œãƒ¢ãƒ‡ãƒ«:** æ—¥æ¬¡å˜ä¸€å®Ÿè¡Œï¼ˆRun Once Dailyï¼‰
- **ã‚³ãƒ³ãƒ†ãƒŠåŒ–:** Dockerå®Œå…¨éš”é›¢ç’°å¢ƒ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:** SQLiteï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—æ©Ÿèƒ½ä»˜ãï¼‰
- **å‡ºåŠ›å½¢å¼:** Markdownæ—¥æ¬¡ãƒ–ãƒ­ã‚°ï¼ˆYYYY-MM-DD.mdï¼‰
- **é™çš„ã‚µã‚¤ãƒˆ:** Hugoç”Ÿæˆ
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°:** GitHub Pagesè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **è‡ªå‹•åŒ–:** GitHub Actionsï¼ˆæ¯æœ06:00 JSTå®Ÿè¡Œï¼‰

### ä¸»è¦æ©Ÿèƒ½

1. **Web Scraping** - æ—¥æœ¬ä¸»è¦ä¸å‹•ç”£ã‚µã‚¤ãƒˆ7ç¤¾ã‹ã‚‰è‡ªå‹•åé›†
2. **SQLite Rate Limiting** - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨ˆç®—ãƒ»è‡ªå‹•å¾…æ©Ÿ
3. **AI Scoring** - 100ç‚¹æº€ç‚¹ã‚­ãƒ£ãƒ³ãƒ—é©æ€§è©•ä¾¡ï¼ˆ6é …ç›®åˆ†æï¼‰
4. **Daily Blog** - Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã‚‹æ—¥æ¬¡Markdownç”Ÿæˆ
5. **Hugo Build** - å…¨å±¥æ­´è¨˜äº‹ã‚’é™çš„HTMLåŒ–
6. **Git Auto-Push** - GitHubè‡ªå‹•ãƒ—ãƒƒã‚·ãƒ¥ãƒ»Pageså…¬é–‹

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#3-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#4-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
5. [Dockerç’°å¢ƒ](#5-dockerç’°å¢ƒ)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#6-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
7. [ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚·ã‚¹ãƒ†ãƒ ](#7-ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚·ã‚¹ãƒ†ãƒ )
8. [ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè£…](#8-ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè£…)
9. [AIåˆ†æã‚¨ãƒ³ã‚¸ãƒ³](#9-aiåˆ†æã‚¨ãƒ³ã‚¸ãƒ³)
10. [ãƒ–ãƒ­ã‚°ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ](#10-ãƒ–ãƒ­ã‚°ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ )
11. [Hugoé™çš„ã‚µã‚¤ãƒˆ](#11-hugoé™çš„ã‚µã‚¤ãƒˆ)
12. [Gitè‡ªå‹•å…¬é–‹](#12-gitè‡ªå‹•å…¬é–‹)
13. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#13-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
14. [GitHub Actions](#14-github-actions)
15. [é‹ç”¨æ‰‹é †](#15-é‹ç”¨æ‰‹é †)
16. [ä»˜éŒ²](#16-ä»˜éŒ²)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›®çš„

æ—¥æœ¬å…¨å›½ã®ä¸å‹•ç”£ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å ´ã«é©ã—ãŸåœŸåœ°ã‚’è‡ªå‹•åé›†ã—ã€AIåˆ†æã«ã‚ˆã£ã¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã—ã€çµæœã‚’æ—¥æ¬¡ãƒ–ãƒ­ã‚°ã¨ã—ã¦è‡ªå‹•å…¬é–‹ã™ã‚‹å®Œå…¨è‡ªå‹•åŒ–ãƒãƒƒãƒã‚·ã‚¹ãƒ†ãƒ ã€‚

### 1.2 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼

- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å ´è³¼å…¥æ¤œè¨è€…
- ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå®šä½åœ°æ¢ã—ï¼‰
- ã‚ªãƒ•ã‚°ãƒªãƒƒãƒ‰ç”Ÿæ´»å¸Œæœ›è€…
- å°è¦æ¨¡ã‚­ãƒ£ãƒ³ãƒ—å ´çµŒå–¶è€…

### 1.3 é‡è¦æ¤œç´¢æ¡ä»¶

| é …ç›® | æ¡ä»¶ | å„ªå…ˆåº¦ | ç†ç”± |
|------|------|--------|------|
| åºƒã• | 1,000ã¡ä»¥ä¸Š | â˜…â˜…â˜… | ã‚­ãƒ£ãƒ³ãƒ—å ´ã¨ã—ã¦ååˆ†ãªåºƒã• |
| é“è·¯å¹…å“¡ | 4.5mä»¥ä¸Š | â˜…â˜…â˜… | ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼é€šè¡Œå¯ |
| å‘¨è¾ºäººå£å¯†åº¦ | 50äºº/kmÂ²ä»¥ä¸‹ | â˜…â˜…â˜… | é™å¯‚æ€§ç¢ºä¿ |
| æœ€è¿‘éš£ä½å®… | 500mä»¥ä¸Šæ¨å¥¨ | â˜…â˜…â˜… | ç™ºé›»æ©Ÿä½¿ç”¨æ™‚ã®é…æ…® |
| åœ°åŸŸ | é–¢æ±ãƒ»ä¸­éƒ¨å„ªå…ˆ | â˜…â˜… | ã‚¢ã‚¯ã‚»ã‚¹åˆ©ä¾¿æ€§ |
| ä¾¡æ ¼ | 3,000ä¸‡å††ä»¥ä¸‹ | â˜…â˜… | ç¾å®Ÿçš„ãªäºˆç®— |

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Host Machine (Linux/Mac/Win)       â”‚
â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Docker Container (Daily Run)     â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Python 3.12 + Chrome + Hugo â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  [Batch Agent Process]       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  1. Scrape (Rate Limited)    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  2. Analyze & Score          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  3. Generate Markdown        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  4. Hugo Build               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  5. Git Push                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚
â”‚  ğŸ“ ./data/ (Volume Mapped)               â”‚
â”‚     â”œâ”€â”€ seccamp.db                        â”‚
â”‚     â”œâ”€â”€ logs/                             â”‚
â”‚     â””â”€â”€ hugo_site/                        â”‚
â”‚         â”œâ”€â”€ content/posts/*.md            â”‚
â”‚         â””â”€â”€ public/ (Built Site)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  GitHub Repository     â”‚
        â”‚  (gh-pages branch)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   GitHub Pages        â”‚
        â”‚   Public Website      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
START
  â†“
[Initialize]
â”œâ”€ Load .env
â”œâ”€ Setup logger
â””â”€ Connect SQLite
  â†“
[Scraping Loop]
For each site:
  â”œâ”€ Load rate config
  â”œâ”€ Check current count
  â”œâ”€ Wait if needed
  â”œâ”€ Scrape pages
  â”œâ”€ Record request
  â””â”€ Save to DB
  â†“
[AI Analysis]
For each property:
  â”œâ”€ Calculate 6 scores
  â”œâ”€ Sum to total (0-100)
  â””â”€ Save to ai_scores
  â†“
[Blog Generation]
â”œâ”€ Get TOP 50 props
â”œâ”€ Calculate stats
â”œâ”€ Render Jinja2
â””â”€ Save YYYY-MM-DD.md
  â†“
[Hugo Build]
â”œâ”€ Run: hugo --minify
â”œâ”€ Compile all posts
â””â”€ Generate public/
  â†“
[Git Push]
â”œâ”€ Add changes
â”œâ”€ Commit
â””â”€ Push to remote
  â†“
[Cleanup & Exit]
END
```

---

## 3. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 3.1 ã‚³ã‚¢æŠ€è¡“ä¸€è¦§

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|---------|------|-----------|------|
| Container | Docker | 24.0+ | ç’°å¢ƒéš”é›¢ |
| Base OS | Debian 12 (Bookworm) | - | Pythonãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ |
| Language | Python | 3.12+ | ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ |
| Browser | Chrome Headless | Latest | ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° |
| Database | SQLite | 3.40+ | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– |
| Static Gen | Hugo Extended | 0.120+ | é™çš„ã‚µã‚¤ãƒˆ |
| Template | Jinja2 | 3.1+ | Markdownç”Ÿæˆ |
| VCS | Git | 2.40+ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† |

### 3.2 Pythonä¾å­˜é–¢ä¿‚

```txt
# Core Web Scraping
selenium==4.16.0
beautifulsoup4==4.12.2
lxml==4.9.3
requests==2.31.0

# Database
sqlalchemy==2.0.23

# Template & Markdown
jinja2==3.1.2
markdown==3.5.1
pyyaml==6.0.1

# Utilities
python-dotenv==1.0.0
tenacity==8.2.3

# Optional
pandas==2.1.4
```

---

## 4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
seccamp/
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ requirements.txt
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ daily-batch.yml
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ scrapers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_scraper.py
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py
â”‚   â”‚   â”œâ”€â”€ athome_scraper.py
â”‚   â”‚   â”œâ”€â”€ suumo_scraper.py
â”‚   â”‚   â””â”€â”€ ieichiba_scraper.py
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â””â”€â”€ operations.py
â”‚   â”œâ”€â”€ analyzers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ scorer.py
â”‚   â”œâ”€â”€ blog_generator/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ daily_post.py
â”‚   â”‚   â”œâ”€â”€ hugo_builder.py
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â””â”€â”€ daily_post.j2
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ logger.py
â”‚       â””â”€â”€ git_pusher.py
â”‚
â””â”€â”€ data/  (ğŸ”µ VOLUME MAPPED)
    â”œâ”€â”€ seccamp.db
    â”œâ”€â”€ logs/
    â”‚   â””â”€â”€ seccamp-YYYY-MM-DD.log
    â””â”€â”€ hugo_site/
        â”œâ”€â”€ config.toml
        â”œâ”€â”€ content/
        â”‚   â””â”€â”€ posts/
        â”‚       â”œâ”€â”€ 2025-12-24.md
        â”‚       â””â”€â”€ ...
        â”œâ”€â”€ themes/
        â”‚   â””â”€â”€ seccamp-theme/
        â”œâ”€â”€ static/
        â””â”€â”€ public/
```

---

## 5. Dockerç’°å¢ƒ

### 5.1 Dockerfile

```dockerfile
FROM python:3.12-slim

ENV TZ=Asia/Tokyo
ENV PYTHONUNBUFFERED=1

# Install system dependencies
RUN apt-get update && apt-get install -y \
    wget curl gnupg ca-certificates git unzip \
    fonts-liberation libasound2 libatk-bridge2.0-0 \
    --no-install-recommends && rm -rf /var/lib/apt/lists/*

# Install Chrome
RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \
    && echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list \
    && apt-get update && apt-get install -y google-chrome-stable \
    && rm -rf /var/lib/apt/lists/*

# Install ChromeDriver
RUN CHROME_VERSION=$(google-chrome --version | awk '{print $3}' | cut -d '.' -f 1) \
    && CHROMEDRIVER_VERSION=$(curl -sS "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROME_VERSION") \
    && wget -q "https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip" \
    && unzip chromedriver_linux64.zip && mv chromedriver /usr/local/bin/ \
    && chmod +x /usr/local/bin/chromedriver && rm chromedriver_linux64.zip

# Install Hugo
ARG HUGO_VERSION=0.120.4
RUN wget -q "https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_Linux-64bit.tar.gz" \
    && tar -xzf hugo_extended_${HUGO_VERSION}_Linux-64bit.tar.gz \
    && mv hugo /usr/local/bin/ && chmod +x /usr/local/bin/hugo \
    && rm hugo_extended_${HUGO_VERSION}_Linux-64bit.tar.gz

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

COPY app/ /app/

RUN mkdir -p /data/logs /data/hugo_site/content/posts

VOLUME ["/data"]

RUN useradd -m -u 1000 seccamp && chown -R seccamp:seccamp /app /data
USER seccamp

ENTRYPOINT ["python", "main.py"]
CMD ["--mode", "full"]
```

### 5.2 docker-compose.yml

```yaml
version: '3.8'

services:
  seccamp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: seccamp-batch
    volumes:
      - ./data:/data
    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - GITHUB_REPO=${GITHUB_REPO}
    env_file:
      - .env
    restart: "no"
    networks:
      - seccamp-network

networks:
  seccamp-network:
    driver: bridge
```

### 5.3 å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# Build
docker-compose build

# Run full batch
docker-compose up

# Run specific mode
docker-compose run --rm seccamp --mode scrape
docker-compose run --rm seccamp --mode full

# Debug shell
docker-compose run --rm --entrypoint /bin/bash seccamp

# View logs
docker-compose logs -f
```

---

## 6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 6.1 ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

#### rate_limits (ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨­å®š)

```sql
CREATE TABLE rate_limits (
    limit_id INTEGER PRIMARY KEY AUTOINCREMENT,
    site_name TEXT UNIQUE NOT NULL,
    max_requests INTEGER NOT NULL DEFAULT 60,
    period_seconds INTEGER NOT NULL DEFAULT 300,
    created_at TEXT DEFAULT (datetime('now'))
);

INSERT INTO rate_limits (site_name, max_requests, period_seconds) VALUES
('athome', 60, 300),
('suumo', 30, 300),
('ieichiba', 20, 300);
```

#### rate_limit_tracker (ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±¥æ­´)

```sql
CREATE TABLE rate_limit_tracker (
    tracker_id INTEGER PRIMARY KEY AUTOINCREMENT,
    site_name TEXT NOT NULL,
    request_timestamp TEXT NOT NULL,
    response_time_ms INTEGER,
    status TEXT CHECK(status IN ('success', 'failed', 'timeout')),
    FOREIGN KEY (site_name) REFERENCES rate_limits(site_name)
);

CREATE INDEX idx_tracker_site_time 
ON rate_limit_tracker(site_name, request_timestamp DESC);
```

#### properties (ç‰©ä»¶ãƒã‚¹ã‚¿ãƒ¼)

```sql
CREATE TABLE properties (
    property_id INTEGER PRIMARY KEY AUTOINCREMENT,
    source_site TEXT NOT NULL,
    source_property_id TEXT NOT NULL,
    property_name TEXT,
    location_pref TEXT NOT NULL,
    location_city TEXT NOT NULL,
    area_sqm INTEGER,
    price_yen INTEGER,
    is_free BOOLEAN DEFAULT 0,
    road_width_m REAL,
    population_density REAL,
    nearest_house_distance_m INTEGER,
    campsite_score REAL DEFAULT 0,
    scraped_at TEXT NOT NULL,
    last_seen_at TEXT NOT NULL,
    is_active BOOLEAN DEFAULT 1,
    UNIQUE(source_site, source_property_id)
);

CREATE INDEX idx_score ON properties(campsite_score DESC);
```

#### ai_scores (AIã‚¹ã‚³ã‚¢)

```sql
CREATE TABLE ai_scores (
    score_id INTEGER PRIMARY KEY AUTOINCREMENT,
    property_id INTEGER NOT NULL,
    area_score REAL DEFAULT 0 CHECK(area_score >= 0 AND area_score <= 25),
    neighbor_score REAL DEFAULT 0 CHECK(neighbor_score >= 0 AND neighbor_score <= 20),
    road_score REAL DEFAULT 0 CHECK(road_score >= 0 AND road_score <= 20),
    convenience_score REAL DEFAULT 0 CHECK(convenience_score >= 0 AND convenience_score <= 15),
    scenery_score REAL DEFAULT 0 CHECK(scenery_score >= 0 AND scenery_score <= 10),
    access_score REAL DEFAULT 0 CHECK(access_score >= 0 AND access_score <= 10),
    total_score REAL DEFAULT 0 CHECK(total_score >= 0 AND total_score <= 100),
    confidence REAL DEFAULT 0,
    calculated_at TEXT NOT NULL,
    FOREIGN KEY (property_id) REFERENCES properties(property_id)
);
```

#### daily_blogs (ãƒ–ãƒ­ã‚°ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿)

```sql
CREATE TABLE daily_blogs (
    blog_id INTEGER PRIMARY KEY AUTOINCREMENT,
    blog_date TEXT UNIQUE NOT NULL,
    markdown_path TEXT NOT NULL,
    properties_featured INTEGER DEFAULT 0,
    hugo_built_at TEXT,
    git_commit_hash TEXT,
    generated_at TEXT NOT NULL
);
```

---

## 7. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚·ã‚¹ãƒ†ãƒ 

### 7.1 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

```python
def can_make_request(self, site_name: str) -> Dict:
    # Get config
    max_requests = 60
    period_seconds = 300  # 5 minutes

    # Current window
    now = datetime.utcnow()
    window_start = now - timedelta(seconds=period_seconds)

    # Count successful requests in window
    count = db.execute(
        "SELECT COUNT(*) FROM rate_limit_tracker "
        "WHERE site_name = ? AND request_timestamp >= ? "
        "AND status = 'success'",
        (site_name, window_start.isoformat())
    )

    if count >= max_requests:
        # Calculate wait time
        oldest = db.execute(
            "SELECT request_timestamp FROM rate_limit_tracker "
            "WHERE site_name = ? ORDER BY request_timestamp ASC LIMIT 1",
            (site_name,)
        )
        expire_time = oldest + timedelta(seconds=period_seconds)
        wait_seconds = (expire_time - now).total_seconds()

        return {'allowed': False, 'wait_seconds': wait_seconds}

    return {'allowed': True, 'wait_seconds': 0}
```

### 7.2 è‡ªå‹•å¾…æ©Ÿãƒ­ã‚¸ãƒƒã‚¯

```python
def wait_if_needed(self, site_name: str):
    check = self.can_make_request(site_name)

    if not check['allowed']:
        wait_time = check['wait_seconds']
        logger.warning(f"Rate limit reached. Waiting {wait_time}s...")
        time.sleep(wait_time)
        return True

    return False
```

---

## 8. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè£…

### 8.1 BaseScraper (åŸºåº•ã‚¯ãƒ©ã‚¹)

```python
class BaseScraper(ABC):
    def __init__(self, site_name, base_url, db_path, logger):
        self.site_name = site_name
        self.rate_limiter = RateLimiter(db_path, logger)
        self.max_retries = 3
        self.page_timeout = 30

    def setup_driver(self):
        options = Options()
        options.add_argument('--headless=new')
        options.add_argument('--no-sandbox')
        options.add_argument('--disable-gpu')
        self.driver = webdriver.Chrome(options=options)

    def safe_get(self, url: str) -> bool:
        try:
            start_time = time.time()
            self.driver.get(url)
            response_time = int((time.time() - start_time) * 1000)

            self.rate_limiter.record_request(
                self.site_name, 'success', response_time
            )
            return True
        except TimeoutException:
            self.rate_limiter.record_request(
                self.site_name, 'timeout'
            )
            raise

    def scrape(self) -> List[Dict]:
        try:
            self.setup_driver()
            self.rate_limiter.wait_if_needed(self.site_name)
            properties = self._scrape_implementation()
            return properties
        finally:
            self.teardown_driver()

    @abstractmethod
    def _scrape_implementation(self) -> List[Dict]:
        pass
```

---

## 9. AIåˆ†æã‚¨ãƒ³ã‚¸ãƒ³

### 9.1 ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯

```python
class PropertyScorer:
    def calculate_score(self, property_data: dict) -> dict:
        scores = {}

        # 1. åºƒã•ã‚¹ã‚³ã‚¢ (0-25ç‚¹)
        area_sqm = property_data.get('area_sqm', 0)
        ideal_area = 5000
        scores['area_score'] = min(25, (area_sqm / ideal_area) * 25)

        # 2. éš£è¿‘æ‰€é…æ…®ã‚¹ã‚³ã‚¢ (0-20ç‚¹) â˜…é‡è¦â˜…
        neighbor_distance = property_data.get('nearest_house_distance_m', 0)
        if neighbor_distance >= 500:
            scores['neighbor_score'] = 20
        elif neighbor_distance >= 300:
            scores['neighbor_score'] = 15
        else:
            scores['neighbor_score'] = 10

        # 3. é“è·¯é©æ€§ã‚¹ã‚³ã‚¢ (0-20ç‚¹) â˜…é‡è¦â˜…
        road_width = property_data.get('road_width_m', 0)
        if road_width >= 4.5:
            scores['road_score'] = 20
        elif road_width >= 3.5:
            scores['road_score'] = 15
        else:
            scores['road_score'] = 10

        # 4. ç”Ÿæ´»åˆ©ä¾¿æ€§ã‚¹ã‚³ã‚¢ (0-15ç‚¹)
        conbini_km = property_data.get('nearest_conbini_km', 999)
        scores['convenience_score'] = 15 if conbini_km < 10 else 10

        # 5. æ™¯è¦³ã‚¹ã‚³ã‚¢ (0-10ç‚¹)
        scores['scenery_score'] = 10

        # 6. ã‚¢ã‚¯ã‚»ã‚¹ã‚¹ã‚³ã‚¢ (0-10ç‚¹)
        station_km = property_data.get('nearest_station_km', 999)
        scores['access_score'] = 10 if station_km < 10 else 5

        # åˆè¨ˆ
        scores['total_score'] = sum(scores.values())
        scores['confidence'] = 0.85

        return scores
```

---

## 10. ãƒ–ãƒ­ã‚°ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

### 10.1 æ—¥æ¬¡Markdownç”Ÿæˆ

```python
class DailyPostGenerator:
    def generate_post(self, date: str, properties: List[Dict], 
                     stats: Dict) -> Path:
        template = self._get_template()

        context = {
            'date': date,
            'total_properties': stats.get('total', 0),
            'new_properties': stats.get('new', 0),
            'avg_score': stats.get('avg_score', 0),
            'top_properties': properties[:10]
        }

        markdown = template.render(**context)

        post_path = self.posts_dir / f"{date}.md"
        with open(post_path, 'w', encoding='utf-8') as f:
            f.write(markdown)

        return post_path
```

### 10.2 Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```jinja2
---
title: "{{ date }} ã‚­ãƒ£ãƒ³ãƒ—é©åœ°ãƒ¬ãƒãƒ¼ãƒˆ"
date: {{ date }}T06:00:00+09:00
tags: ["daily", "{{ date[:4] }}"]
---

## ğŸ“Š æœ¬æ—¥ã®çµ±è¨ˆ

- ç·ç‰©ä»¶æ•°: {{ total_properties }}ä»¶
- æ–°è¦ç‰©ä»¶: {{ new_properties }}ä»¶
- å¹³å‡ã‚¹ã‚³ã‚¢: {{ avg_score|round(1) }}ç‚¹

## ğŸ† TOP 10ç‰©ä»¶

{% for property in top_properties %}
### {{ loop.index }}. {{ property.name }}

- ğŸ“ æ‰€åœ¨åœ°: {{ property.location }}
- ğŸ“ é¢ç©: {{ property.area_sqm }}mÂ²
- ğŸ’° ä¾¡æ ¼: {{ property.price_formatted }}
- â­ ã‚¹ã‚³ã‚¢: **{{ property.score }}/100ç‚¹**

---
{% endfor %}
```

---

## 11. Hugoé™çš„ã‚µã‚¤ãƒˆ

### 11.1 config.toml

```toml
baseURL = "https://username.github.io/seccamp/"
languageCode = "ja"
title = "SECCAMP - ã‚­ãƒ£ãƒ³ãƒ—é©åœ°ãƒ¬ãƒãƒ¼ãƒˆ"
theme = "seccamp-theme"

[params]
  description = "AIè‡ªå‹•åˆ†æã«ã‚ˆã‚‹æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ"
  author = "SECCAMP Bot"

[menu]
  [[menu.main]]
    name = "ãƒ›ãƒ¼ãƒ "
    url = "/"
  [[menu.main]]
    name = "è¨˜äº‹ä¸€è¦§"
    url = "/posts/"
```

### 11.2 Hugo Build

```python
class HugoBuilder:
    def build(self) -> bool:
        result = subprocess.run(
            ['hugo', '--minify'],
            cwd=self.site_dir,
            capture_output=True,
            timeout=60
        )

        if result.returncode == 0:
            logger.info("Hugo build successful")
            return True
        else:
            logger.error(f"Hugo build failed: {result.stderr}")
            return False
```

---

## 12. Gitè‡ªå‹•å…¬é–‹

### 12.1 GitPusher

```python
class GitPusher:
    def commit_and_push(self, message: str) -> Optional[str]:
        try:
            # Add files
            subprocess.run(['git', 'add', 'public/'], cwd=self.repo_dir)
            subprocess.run(['git', 'add', 'content/posts/'], cwd=self.repo_dir)

            # Commit
            subprocess.run(['git', 'commit', '-m', message], cwd=self.repo_dir)

            # Get commit hash
            result = subprocess.run(
                ['git', 'rev-parse', 'HEAD'],
                cwd=self.repo_dir,
                capture_output=True,
                text=True
            )
            commit_hash = result.stdout.strip()

            # Push
            subprocess.run(['git', 'push', 'origin', 'main'], cwd=self.repo_dir)

            return commit_hash
        except Exception as e:
            logger.error(f"Git push failed: {e}")
            return None
```

---

## 13. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 13.1 ãƒªãƒˆãƒ©ã‚¤ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿

```python
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(stop=stop_after_attempt(3), 
       wait=wait_exponential(multiplier=1, min=2, max=10))
def safe_get(url: str):
    driver.get(url)
```

### 13.2 ä¾‹å¤–å‡¦ç†

```python
try:
    properties = scraper.scrape()
except TimeoutException:
    logger.warning("Timeout, will retry...")
except WebDriverException as e:
    logger.error(f"WebDriver error: {e}")
finally:
    driver.quit()
```

---

## 14. GitHub Actions

### 14.1 Workflowè¨­å®š

```yaml
name: SECCAMP Daily Batch

on:
  schedule:
    - cron: '0 21 * * *'  # 06:00 JST
  workflow_dispatch:

jobs:
  run-batch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build Docker
        run: docker-compose build

      - name: Run batch
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: docker-compose run --rm seccamp --mode full

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./data/hugo_site/public
          publish_branch: gh-pages
```

---

## 15. é‹ç”¨æ‰‹é †

### 15.1 åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. Clone repository
git clone https://github.com/username/seccamp.git
cd seccamp

# 2. Create .env file
cp .env.example .env
# Edit .env with your GitHub token

# 3. Create data directory
mkdir -p data/hugo_site/content/posts

# 4. Initialize Hugo site
cd data/hugo_site
hugo new site . --force
cd ../..

# 5. Build Docker image
docker-compose build

# 6. First run
docker-compose up
```

### 15.2 æ—¥æ¬¡å®Ÿè¡Œ

GitHub ActionsãŒè‡ªå‹•çš„ã«æ¯æœ06:00 JSTã«å®Ÿè¡Œã—ã¾ã™ã€‚

æ‰‹å‹•å®Ÿè¡Œ:
```bash
docker-compose up
```

### 15.3 ãƒ­ã‚°ç¢ºèª

```bash
# View latest log
tail -f data/logs/seccamp-$(date +%Y-%m-%d).log

# Check database
sqlite3 data/seccamp.db "SELECT * FROM scraping_logs ORDER BY started_at DESC LIMIT 10"
```

---

## 16. ä»˜éŒ²

### 16.1 å¯¾è±¡ä¸å‹•ç”£ã‚µã‚¤ãƒˆ

| No. | ã‚µã‚¤ãƒˆå | URL | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ |
|-----|---------|-----|-----------|
| 1 | ã‚¢ãƒƒãƒˆãƒ›ãƒ¼ãƒ  | athome.co.jp | 60 req/5min |
| 2 | SUUMO | suumo.jp | 30 req/5min |
| 3 | å®¶ã„ã¡ã° | ieichiba.com | 20 req/5min |
| 4 | ã‚¼ãƒ­å††ç‰©ä»¶ | zero.estate | 10 req/5min |
| 5 | ã‚¸ãƒ¢ãƒ†ã‚£ãƒ¼ | jmty.jp | 20 req/5min |

### 16.2 ç’°å¢ƒå¤‰æ•°

```bash
# .env file
LOG_LEVEL=INFO
GITHUB_TOKEN=ghp_xxxxx
GITHUB_REPO=username/seccamp
GITHUB_USER=Your Name
GITHUB_EMAIL=your@email.com
HUGO_BASE_URL=https://username.github.io/seccamp/
```

### 16.3 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

| å•é¡Œ | åŸå›  | è§£æ±ºç­– |
|------|------|--------|
| Chrome driver error | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´ | docker-compose build --no-cache |
| Rate limit exceeded | ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é | DBã§ period_seconds èª¿æ•´ |
| Hugo build failed | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ | ãƒ­ã‚°ç¢ºèªã€æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ |
| Git push failed | èªè¨¼ã‚¨ãƒ©ãƒ¼ | GITHUB_TOKEN ç¢ºèª |

### 16.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

```python
# Disable images for faster scraping
chrome_options.add_argument('--disable-images')
chrome_options.add_argument('--blink-settings=imagesEnabled=false')

# Adjust timeouts
self.page_timeout = 30
self.element_timeout = 10
```

---

## ã¾ã¨ã‚

æœ¬ä»•æ§˜æ›¸ã«åŸºã¥ãå®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€å®Œå…¨è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å ´ç‰©ä»¶æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚

### ä¸»è¦ãªç‰¹å¾´

âœ… Dockerå®Œå…¨éš”é›¢ç’°å¢ƒ  
âœ… SQLiteãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™  
âœ… æ—¥æ¬¡Markdownãƒ–ãƒ­ã‚°è‡ªå‹•ç”Ÿæˆ  
âœ… Hugoé™çš„ã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ‰  
âœ… GitHub Pagesè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤  
âœ… å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°  
âœ… GitHub Actionsè‡ªå‹•å®Ÿè¡Œ  

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. æœ¬ä»•æ§˜æ›¸ã«åŸºã¥ã„ã¦ã‚³ãƒ¼ãƒ‰å®Ÿè£…
2. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
3. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
4. GitHub Actionsã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
5. æœ¬ç•ªé‹ç”¨é–‹å§‹

---

**ä½œæˆè€…:** SECCAMPé–‹ç™ºãƒãƒ¼ãƒ   
**æœ€çµ‚æ›´æ–°:** 2025å¹´12æœˆ24æ—¥ 19:35 JST  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 3.0 (Complete)  
**ãƒ©ã‚¤ã‚»ãƒ³ã‚¹:** MIT  
**å•ã„åˆã‚ã›:** seccamp@example.com
